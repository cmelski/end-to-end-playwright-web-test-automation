feature: CHECKOUT_COMPLETE
scenario: End to end flow of adding products to shopping cart and completing purchase

flow:
  - steps:
      - action: add_to_cart
        parameters:
          products:
            - ${PRODUCT_1}
            - ${PRODUCT_2}

  - assertions:
      - cart_badge_icon:
          - name: cart_badge
            toHaveCount: 2

  - steps:
      - action: open_cart

  - steps:
      - action: capture_cart_details
        parameters:
          save_as: shopping_cart

  - steps:
      - action: click_checkout

  - assertions:
      - checkout_step1_loaded:
          - name: page_title
            toContainText: Your Information
          - name: url
            value: https://www.saucedemo.com/checkout-step-one.html

  - steps:
      - action: fill_user_info

  - steps:
      - action: continue_checkout

  - assertions:
      - checkout_step2_loaded:
          - name: page_title
            toContainText: Overview
          - name: url
            value: https://www.saucedemo.com/checkout-step-two.html

      - cart_details_match:
          context_key: shopping_cart

      - checkout_step2_financials:
          - name: cart_subtotal_price
          - name: cart_total_price

  - steps:
      - action: finish_checkout

  - assertions:
      - checkout_complete_loaded:
          - name: page_title
            toContainText: Complete

          - name: url
            value: https://www.saucedemo.com/checkout-complete.html

          - name: order_complete_image
            toBeVisible: true




